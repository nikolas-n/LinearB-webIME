window.wordlib = {
"a": "𐀀",
"e": " 𐀁",
"i": "𐀂",
"o": "𐀃",
"u": "𐀄",
"da": "𐀅",
"de": "𐀆",
"di": "𐀇",
"do": "𐀈",
"du": "𐀉",
"ja": "𐀊",
"je": "𐀋",
"jo": "𐀍",
"ka": "𐀏",
"ke": "𐀐",
"ki": "𐀑",
"ko": "𐀒",
"ku": "𐀓",
"ma": "𐀔",
"me": "𐀕",
"mi": "𐀖",
"mo": "𐀗",
"mu": "𐀘",
"na": "𐀙",
"ne": "𐀚",
"ni": "𐀛",
"no": "𐀜",
"nu": "𐀝",
"pa": "𐀞",
"pe": "𐀟",
"pi": "𐀠",
"po": "𐀡",
"pu": "𐀢",
"qa": "𐀣",
"qe": "𐀤",
"qi": "𐀥",
"qo": "𐀦",
"ra": "𐀨",
"re": "𐀩",
"ri": "𐀪",
"ro": "𐀫",
"ru": "𐀬",
"sa": "𐀭",
"se": "𐀮",
"si": "𐀯",
"so": "𐀰",
"su": "𐀱",
"ta": "𐀲",
"te": "𐀳",
"ti": "𐀴",
"to": "𐀵",
"tu": "𐀶",
"wa": "𐀷",
"we": "𐀸",
"wi": "𐀹",
"wo": "𐀺",
"za": "𐀼",
"ze": "𐀽",
"zo": "𐀿",
"ha": "𐁀",
"ai": "𐁁",
"au": "𐁂",
"dwe": "𐁃",
"dwo": "𐁄",
"nwa": "𐁅",
"pte": "𐁇",
"phu": "𐁆",
"rya": "𐁈",
"rai": "𐁉",
"ryo": "𐁊",
"tya": "𐁋",
"twe": "𐁌",
"two": "𐁍",
"vir": "𐂀",
"mul": "𐂁",
"cerv": "𐂂",
"equ": "𐂃",
"equf": "𐂄",
"equm": "𐂅",
"ovis": "𐀥",
"ovisf": "𐂆",
"ovism": "𐂇",
"cap": "𐁒",
"capf": "𐂈",
"capm": "𐂉",
"sus": "𐁂",
"susf": "𐂊",
"susm": "𐂋",
"bos": "𐀘",
"bosf": "𐂌",
"bosm": "𐂍",
"gra": "𐂎",
"hord": "𐂏",
"oliv": "𐂐",
"ficus": "𐀛",
"farina": "𐀎",
"arom": "𐂑",
"ses": "𐀭",
"cumin": "𐀓",
"cel": "𐀯",
"fen": "𐀔",
"cyp": "𐂒",
"kapo": "𐂓",
"kanako": "𐂔",
"ole": "𐂕",
"vin": "𐂖",
"ung": "𐂘",
"honey": "𐂙",
"sar": "𐃟",
"tri": "𐃠",
"poc": "𐃡",
"urceus": "𐃢",
"hirnea": "𐃣",
"hirnu": "𐃤",
"hyd": "𐃥",
"tria": "𐃦",
"pat": "𐃧",
"amph": "𐃨",
"sjar": "𐃩",
"sit": "𐃫",
"lanx": "𐃬",
"scam": "𐃄",
"alv": "𐃅",
"has": "𐃆",
"sag": "𐃇",
"pel": "𐃈",
"dag": "𐃉",
"gla": "𐃊",
"big": "𐃌",
"cur": "𐃍",
"caps": "𐃎",
"rota": "𐃏",
"unus": "𐄇",
"duo": "𐄈",
"tres": "𐄉",
"quat": "𐄊",
"quin": "𐄋",
"sex": "𐄌",
"sept": "𐄍",
"oct": "𐄎",
"nov": "𐄏",
"dec": "𐄐",
"vig": "𐄑",
"trig": "𐄒",
"quad": "𐄓",
"quinq": "𐄔",
"sexa": "𐄕",
"septu": "𐄖",
"octo": "𐄗",
"nona": "𐄘",
"cent": "𐄙",
"duc": "𐄚",
"trec": "𐄛",
"quadr": "𐄜",
"quing": "𐄝",
"sesc": "𐄞",
"septi": "𐄟",
"octi": "𐄠",
"nong": "𐄡",
"mil": "𐄢",
"dmil": "𐄣",
"tmil": "𐄤",
"qmil": "𐄥",
"qumil": "𐄦",
"smil": "𐄧",
"spmil": "𐄨",
"omil": "𐄩",
"nmil": "𐄪",
"demil": "𐄫",
"dumil": "𐄬",
"trmil": "𐄭",
"quamil": "𐄮",
"quimil": "𐄯",
"semil": "𐄰",
"sepmil": "𐄱",
"octmil": "𐄲",
"nonmil": "𐄳",
"weightb": "𐄷",
"weightf": "𐄸",
"weights": "𐄹",
"weightt": "𐄺",
"weightf": "𐄻",
"dryf": "𐄼",
"liqf": "𐄽",
"meass": "𐄾",
"meast": "𐄿"
};
(function(window){
//Extends build in types
  String.prototype.fs=function() {
    segments=this.split('%s');
    ret='';
    for (var i in arguments) {
      ret += segments[i] + arguments[i];
    }
    return ret + segments[segments.length-1];
  }
  String.prototype.trim=function() {
      return this.replace(/^\s+|\s+$/g,"");
  }
  String.prototype.ltrim=function() {
      return this.replace(/^\s+/,"");
  }
  String.prototype.rtrim=function() {
      return this.replace(/\s+$/,"");
  };
  String.prototype.empty=function() {
      return this == '';
  };
  String.prototype.endswith=function(substr) {
      return this.slice(-substr.length) == substr;
  }
  String.prototype.startswith=function(substr) {
      return this.slice(0, substr.length) == substr;
  }


  if (!Array.prototype.forEach)
    Array.prototype.forEach=function(callback){
      for (var i=0; i<this.length; i++){
        callback(this[i], i, this);
      }
    }
  
  window.swift = swift = function(selector, ctx){
    if ( !selector )
      return null;
    if ( !ctx )
      ctx = window.document;
    function Swift(tags, selector, context) {
      for (var i=0; i<tags.length; i++) {
        this[i] = tags[i];
      }
      this.length = tags.length;
      this.context = context;
      this.selector = selector;
    }
    // extend Swift prototype
    Swift.prototype = Array.prototype;
    Swift.prototype.constructor = Swift;
    Swift.prototype.find = function(selector) {
      if (this.length) {
        return swift(selector, this[0]);
      }
      return swift([]);
    }
    Swift.prototype.filternot = function(selector) {
      var ised = swift(selector, this.context);
      var noted = [];
      this.each(function() {
        if (!swift.inArray(this, ised)) {
          noted.push(this);
        }
      });
      return swift(noted);
    }
    Swift.prototype.each = function(callback) {
      for (var i=0; i<this.length; i++) {
        callback.call(this[i], i, this);
      }
    }
    Swift.prototype.bind = function(action, callback, cancelBubble) {
      if (window.addEventListener) {
        this.each(function(i){
          this.addEventListener(action, function(event) {
            if (cancelBubble) {
              event.cancelBubble = true;
              event.stopPropagation();
            }
            callback.apply(this, arguments);
          });
        });
      } else if (window.attachEvent) {
        this.each(function(i){
          this.attachEvent('on'+action, function(event) {
            if (cancelBubble) {
              event.cancelBubble = true;
              event.stopPropagation();
            }
            callback.apply(this, arguments);
          });
        });
      }
      return this;
    }
    Swift.prototype.unbind = function(action, callback) {
      if (window.document.removeEventListener)
        this.each(function(i) {
          this.removeEventListener(action, callback);
        });
      else
        this.each(function(i) {
          this.detachEvent("on"+action, callback);
        });
      return this;
    }
    Swift.prototype.toggle = function() {
      if (arguments.length == 2) {
        var action = 'click',
            cb1 = arguments[0],
            cb2 = arguments[1];
      } else {
        var action = arguments[0],
            cb1 = arguments[1],
            cb2 = arguments[2],
            cancelBubble = arguments[3];
      }
      return this.bind(action, function() {
        this.clicked = this.clicked ? (this.clicked + 1) : 1;
        (this.clicked % 2 ? cb1 : cb2).apply(this, arguments);
      }, cancelBubble);
    }
    Swift.prototype.live = function(action, callback) {
      var targets = this;
      swift(this.context).bind(action, function(event) {
        var src = event.target || event.srcElement;
        var matchedTargets = swift(targets.selector, targets.context);
        for (var i=0; i<matchedTargets.length; i++) {
          if (src == matchedTargets[i])
            callback.call(src, event);
        }
      });
      return this;
    }
    var actions = "blur focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error contextmenu".split(" ");
    for (var i=0; i<actions.length; i++) {
      var action = actions[i];
      (function(action) {
        Swift.prototype[action] = function(callback, cancelBubble) {
          return this.bind(action, callback, cancelBubble);
        }
      })(action);
    }
    Swift.prototype.focus = function() {
      if (this.length) {
        this[0].focus();
      }
      return this;
    }
    Swift.prototype.attr = function() {
      if (arguments.length == 1 && swift.type(arguments[0]) == 'Object') {
        for (var name in arguments) {
          this.attr(name, arguments[name]);
        }
        return this;
      } else 
        var name = arguments[0],
            value = arguments[1];
      if (value !== undefined) {
        this.each(function(i) {
          this.setAttribute(name, value);
        });
        return this;
      } else {
        if (this.length) {
          return this[0].getAttribute(name);
        }
      }
    }
    Swift.prototype.tag = function() {
      return this.length ? this[0].tagName.toLowerCase() : undefined;
    }
    Swift.prototype.val = function(value) {
      if (value === undefined) {
        if (this.length) {
          if (this[0].value != null)
            return this[0].value;
          else
            if (this.tag() == 'select') {
              var options = this.children();
              for (var i=0; i<options.length; i++) {
                if (options[i].selected) {
                  return options[i].value;
                }
              }
            } else if (this.tag() == 'input' && this.attr('type') == 'checkbox') {
              var valueList = [];
              for (var i=0; i<this.length; i++)
                if (this[i].tagName.toLowerCase() != 'input' || this[i].type == 'checkbox')
                  return undefined;
                else if (this[i].checked)
                  valueList.push(this[i].value);
              return valueList;
            } else if (this.tag() == 'input' && this.attr('type') == 'radio') {
              for (var i=0; i<this.length; i++)
                if (this[i].tagName.toLowerCase() != 'input' || this[i].type != 'radio')
                  return undefined;
                else if (this[i].checked)
                  return this[i].value;
            } else if (this.tag() == 'textarea') {
              return arguments[1] ? swift.htmlEncode(this[0].value) : this[0].value;
            } else {
              return this[0].value;
            }
        }
      } else {
        if (this.tag() == 'select') {
          var options = this.children();
          for (var i=0; i<options.length; i++) {
            if (options[i].value == value)
              options[i].selected = 'selected';
            else
              options[i].removeAttribute('selected');
          }
        } else if (this.tag() == 'input' && this.attr('type') == 'checkbox') {
          var values = swift.slice(value);
          if (!values.length) values = [value];
          this.each(function() {
            if (this.tagName.toLowerCase() == 'input' && this.type == 'checkbox') {
              var box = this;
              values.forEach(function(v, i, vs){
                if (box.value == v)
                  box.checked = 'checked';
                else
                  box.removeAttribute('checked');
              });
            }
          });
        } else if (this.tag() == 'input' && this.attr('type') == 'radio') {
          this.each(function() {
            if (this.tagName.toLowerCase() == 'input' && this.type == 'radio' && this.value == value)
              this.checked = 'checked';
            else
              this.removeAttribute('checked');
          });
        } else if (this.tag() == 'textarea') {
          this.html(value);
        } else if (this.tag() == 'input') {
          this.each(function() {
            if (this.tagName.toLowerCase() == 'input')
              this.value = value;
          });
        }
      }
    }
    Swift.prototype.id = function(value) {
      this.attr('id', value);
    }
    Swift.prototype.removeAttr = Swift.prototype.rmAttr = function(name) {
      this.each(function() {
        this.removeAttribute(name);
      });
      return this;
    }
    Swift.prototype.css = function() {
      if (arguments.length == 1 && arguments[0] === undefined) return this;
      if (arguments.length == 2 && arguments[1] === undefined) return this;
      if (arguments.length == 1 && swift.type(arguments[0]) == 'Object') {
        for (var name in arguments[0]) {
          this.css(name, arguments[0][name]);
        }
        return this;
      } else
        var name = arguments[0],
            value = arguments[1];
      
      var isIntStyle =  (name.endswith('size') || name.endswith('width') || name.endswith('height') || name == 'left' || name == 'top')
      var name = swift.styleName(name);
      if (value === undefined) { // read
        if (this.length) {
          return this[0].style[name];
        }
      } else { // write
        var elem = this[0];
        if (elem && elem.nodeType !== 3 && elem.nodeType !== 8 && elem.style)
          this.each(function() {
            this.style[name] = (isIntStyle && swift.isInt(value)) ? '%spx'.fs(value) : value;
          });
        return this;
      }
    }
    Swift.prototype.style = function(name) {
      if (this.length) {
        var name = swift.styleName(name);
        if (window.getComputedStyle) {
          return window.getComputedStyle(this[0], null)[name];
        } else {
          return this[0].currentStyle[name];
        }
      }
    }
    Swift.prototype.width = function(value) {
      if (arguments.length) {
        if (!swift.isInt(value)) {
          return this.css('width', value);
        } else {
          return this.css('width', value+'px');
        }
      } else if (this.length) {
        var width = swift.asInt(this.css('width'));
        if (width) return width;
        var padding_left = this.css('padding-width-left') || 0;
        var padding_right = this.css('padding-width-right') || 0;
        return this[0].clientWidth - padding_left - padding_right;
      }
    }
    Swift.prototype.innerWidth = function() {
      return this.width();
    }
    Swift.prototype.outterWidth = function() {
      return this.width2();
    }
    Swift.prototype.innerHeight = function() {
      return this.height();
    }
    Swift.prototype.outterHeight = function() {
      return this.height2();
    }
    Swift.prototype.data = function(name, value) {
      if (arguments.length == 0) return swift.data[this.guid] || null;
      if (arguments.length == 1) return swift.data[this.guid] ? swift.data[this.guid][name] || null : null;
      if (arguments.length == 2) {
        swift.data[this.guid = swift.generateGUID()] = value;
      }
    }
    Swift.prototype.removeData = Swift.prototype.rmData = function(name) {
      if (swift.data[this.guid]) delete swift.data[this.guid];
    }
    Swift.prototype.add = function(other) {
      if (this.length) {
        if (other.length != undefined) {
          for (var i=0; i<other.length; i++) {
            this.push(other[i]);
          }
        } else {
          this.push(other);
        }
      }
      return this;
    }
    Swift.prototype.not = function(callback) {
      var orig = this,
          targets = [];
      this.each(function(i) {
        if (!callback.call(this, i)) {
          targets.push(orig[i]);
        }
      });
      return swift(targets);
    }
    Swift.prototype.width2 = function(value) {
      if (this.length) {
        if (value === undefined) {
          return this[0].clientWidth;
        } else {
          var padding_left = this.css('padding-width-left') || 0;
          var padding_right = this.css('padding-width-right') || 0;
          return this.css('width', value - padding_left - padding_right);
        }
      }
    }
    Swift.prototype.width3 = function(value) {
      if (this.length) {
        if (value === undefined) {
          return this[0].offsetWidth;
        } else {
          var border_left = this.css('border-width-left') || 0;
          var border_right = this.css('border-width-right') || 0;
          return this.width2('width', value - border_left - border_right);
        }
      }
    }
    Swift.prototype.width4 = function() {
      if (this.length) return this[0].scrollWidth;
    }
    Swift.prototype.height = function(value) {
      if (arguments.length) {
        if (!swift.isInt(value)) {
          return this.css('height', value);
        } else {
          return this.css('height', value+'px');
        }
      } else if (this.length) {
        var height = this.css('height');
        if (height) return height;
        var padding_left = this.css('padding-height-left') || 0;
        var padding_right = this.css('padding-height-right') || 0;
        return this[0].clientHeight - padding_left - padding_right;
      }
    }
    Swift.prototype.height2 = function(value) {
      if (this.length) {
        if (value === undefined) {
          return this[0].clientHeight;
        } else {
          var padding_left = this.css('padding-height-left') || 0;
          var padding_right = this.css('padding-height-right') || 0;
          return this.css('height', value - padding_left - padding_right);
        }
      }
    }
    Swift.prototype.height3 = function(value) {
      if (this.length) {
        if (value === undefined) {
          return this[0].offsetHeight;
        } else {
          var border_left = this.css('border-height-left') || 0;
          var border_right = this.css('border-height-right') || 0;
          return this.height2('height', value - border_left - border_right);
        }
      }
    }
    Swift.prototype.height4 = function() {
      if (this.length) return this[0].scrollHeight;
    }
    Swift.prototype.classes = function() {
      if (this.length) return this[0].classList;
    }
    Swift.prototype.hasClass = function(name) {
      if (this.length) return this[0].classList.contains(name);
    }
    Swift.prototype.addClass = function(name) {
      this.each(function(i) {
        this.classList.add(name);
      });
      return this;
    }
    Swift.prototype.removeClass = Swift.prototype.rmClass = function(name) {
      this.each(function(i) {
        this.classList.remove(name);
      });
      return this;
    }
    Swift.prototype.hide = function(speed) {
      if (!speed)
        return this.css('display', 'none');
      var orgwidth = this.css('width');
      var orgheight = this.css('height');
      return this.animate({width:0, height:0}, speed, function() {
        this.hide();
        this.css({width:orgwidth, height:orgheight});
      });
    }
    Swift.prototype.show = function(speed) {
      if (!speed)
        return this.css('display', swift.isinline(this.tag()) ? 'inline' : 'block');
      var orgwidth = this.css('width'),
          orgheight = this.css('height'),
          dsp = this.css('display');
      this.show();
      var width = this.width(),
          height = this.height();
      this.css({width:0, height:0});
      return this.animate({width:width, height:height}, speed, function() {
        this.css({width:orgwidth, height:orgheight});
      });
    }
    Swift.prototype.html = function(htmlStr) {
      if (htmlStr !== undefined) {
        this.each(function(i) {
          this.innerHTML = htmlStr;
        });
        return this;
      } else if (this.length)
        return this[0].innerHTML;
    }
    Swift.prototype.text = function(textStr) {
      if (textStr !== undefined) {
        this.each(function(i) {
          this.innerText = textStr;
        });
        return this;
      } else
        return this.innerText;
    }
    Swift.prototype.remove = function() {
      this.each(function(i) {
        this.parentNode.removeChild(this);
      });
      return this;
    }
    Swift.prototype.append = function(other) {
      if (this.length) {
        if (swift.type(other) == 'String') {
          this.html(this.html() + other);
        } else if (other.length != undefined) {
          for (var i=0; i<other.length; i++) {
            this[0].appendChild(other[i]);
          }
        } else {
          this[0].appendChild(other);
        }
      }
      return this;
    }
    Swift.prototype.appendTo = function(other) {
      if (this.length) 
        for (var i=0; i<this.length; i++) 
          (other.length != undefined ? other[0] : other)
              .appendChild(this[i]);
      return this;
    }
    Swift.prototype.after = function(other) {
      if (this.length) {
        var other = other.length != undefined ? other[0] : other;
        for (var i=0; i<this.length; i++) 
          other.parentElement.insertBefore(this[i], other.next());
      }
      return this;
    }
    Swift.prototype.before = function(other) {
      if (this.length) {
        var other = other.length != undefined ? other[0] : other;
        for (var i=0; i<this.length; i++) 
          other.parentElement.insertBefore(this[i], other);
      }
      return this;
    }
    Swift.prototype.next = function() {
      if (this.length)
        return swift(this[0].nextSibling);
      return swift([]);
    }
    Swift.prototype.prev = function() {
      if (this.length)
        return swift(this[0].previousSibling);
    }
    Swift.prototype.clone = function(includeAll) {
      var newTags = [];
      this.each(function(){
        newTags.push(this.cloneNode(includeAll));
      });
      return swift(newTags);
    }
    Swift.prototype.parent = function() {
      return this.length ? swift(this[0].parentElement) : undefined;
    }
    Swift.prototype.children = function() {
      return this.length ? swift.filter(this[0].childNodes, function() {
        return this.tagName ? true : false;
      }) : swift([]);
    }
    Swift.prototype.load = function(url) {
      var mytag = this;
      swift.get({
        url: url,
        success: function(ret) {
          mytag.html(ret);
        }
      });
      return this;
    }
    Swift.prototype.serialize = function(asObj) {
      if (this.length && this.tag() == 'form') {
        var eles = this[0].elements;
        var data = {}
        for (var i=0; i<eles.length; i++) {
          var ele = eles[i];
          data[ele.name] = swift(ele).val() || '';
        }
        if (asObj) return data;
        var mappings = [];
        for (var k in data)
          mappings.push('%s=%s'.fs(k, encodeURIComponent(data[k])));
        return mappings.join('&');
      }
    }
    Swift.prototype.filter = function(callback /* or selector */) {
      if (typeof callback == "function") {
        return swift.filter.call(this, callback);
      } else if (typeof callback == "string" && callback.startswith("!")) {
        var ised = swift(callback.slice(1), this.context);
        var noted = [];
        this.each(function() {
          if (!swift.inArray(this, ised)) {
            noted.push(this);
          }
        });
        return swift(noted);
      } else if (typeof callback == "string" && !callback.startswith("!")) {
        var restricted = swift(callback, this.context);
        var ised = [];
        this.each(function() {
          if (swift.inArray(this, restricted)) {
            ised.push(this);
          }
        });
        return swift(ised);
      }
    }
    Swift.prototype.dialog = function(param) {
      if (!arguments.length) param = {};
      if (this.length !== 1) return this;

      if (!this.length || !param || !(param instanceof Object)) return;
      var userDlg = this,
          oldParent = this.parent();
      var dlg = userDlg.dialog = swift('<div></div>').addClass('swift-dialog')
                                    .width(param.width)
                                    .height(param.height)
                                    .css('border', 'solid 3px #999')
                                    .css('background', '#FFF')
                                    .css(param.style);

      var bgDiv = param.model ? swift('<div></div>').width(swift(this.doc().body).width())
                                                 .height(swift(this.doc().body).height())
                                                 .css('z-index', '999')
                                                 .css('position', 'absolute')
                                                 .css('left', 0)
                                                 .css('top', 0)
                                                 .css('background', param.bgBackgroundColor 
                                                      || 'rgba(0, 0, 0, %s)'.fs(param.bgAlpha || 0.2))
                                                 .appendTo(this.doc().body)
                          : undefined;

      if (param.title || param.titleDivStyle || param.close || param.closeText || param.closeIcon || param.closeDivStyle)
        var titleDiv = swift('<div></div>').addClass('swift-dialog-title')
                            .html('<span">%s</span>'.fs(param.title || ""))
                            .height(25)
                            .width('100%')
                            .css('text-align', 'center')
                            .css('font-size', '14px')
                            .css(param.titleDivStyle)
                            .appendTo(dlg);

        if (param.close || param.closeText || param.closeIcon || param.closeStyle)
          swift('<div></div>').css('float', 'right')
                              .css('line-height', '25px')
                              .css('font-size', 14)
                              .css(param.closeDivStyle)
                              .css('cusor', 'pointer')
                              .height(25)
                              .css(param.closeDivStyle)
                              .html(param.closeText 
                                     || param.closeIcon ? 
                                         '<img src="%s">'.fs(param.closeIcon) 
                                         : 'X&nbsp;')
                              .appendTo(titleDiv ? titleDiv : dlg)
                              .click(function() {
                                  if (swift.type(param.close) == 'Function') {
                                    if (param.close.apply(userDlg, arguments))
                                      userDlg.close();
                                  } else userDlg.close();
                              });

      if (param.buttons) {
        var bntDiv = swift('<div></div>').addClass('swift-dialog-buttons')
                                         .height(25)
                                         .css({
                                           'float': 'right'
                                         })
                                         .width('100%')
                                         .css(param.buttonDivStyle)
                                         .append(swift('<div></div>').css('float', 'right'));
        for (var text in param.buttons) {
          (function(text) {
            swift('<button></button>').html(text)
                                      .click(function() {
                                        param.buttons[text].apply(userDlg, arguments);
                                      })
                                      .appendTo(bntDiv.children());
          })(text);
        }
        if (bntDiv.children().length) 
            bntDiv.appendTo(dlg);
      }
      if (param.resizable) {//TODO
      }
      if (param.movable) {//TODO
      }
      dlg.css('z-index', '10000')
         .css('position', 'absolute')
         .appendTo(dlg.doc().body);
      var contentDiv = swift('<div></div>').addClass('swift-dialog-content')
                                           .width('100%')
                                           .css(param.contentDivStyle);
      if (bntDiv) contentDiv.before(bntDiv);
      else contentDiv.appendTo(dlg);
      userDlg.appendTo(contentDiv).show();
      contentDiv.height(dlg.height() 
                           - (dlg.find('.swift-dialog-title').height2() || 0)
                           - (dlg.find('.swift-dialog-buttons').height2() || 0))
      if (!param.style || param.style.left == undefined)
        dlg.css('left', window.innerWidth/2 - dlg.width3()/2 + 'px')
      if (!param.style || param.style.top == undefined)
        dlg.css('top', window.innerHeight/2 - dlg.height3()/2 + 'px')
      this.close = function(event) {
        if (oldParent){
          this.appendTo(oldParent);
          if (this.style("display") != "none")
            this.hide();
        } else
          this.remove();
        dlg.remove();
        bgDiv && bgDiv.remove();
      }
      return this;
    }
    Swift.prototype.doc = function() {
      return this.length ? this[0].ownerDocument : undefined;
    }
    Swift.prototype.animate = function(ts/*target style*/, duration, callback) {
      function interpolate(start, end, points) {
        var interval = (end-start) / points,
            values = [];
        for (var i=0; i<points; i++) {
          values.push(start + i*interval);
        }
        values.push(end);
        return values;
      }
      if (swift.type(duration) == 'Function') {
        callback = duration;
        duration = undefined;
      }
      var interval = 10,
          ele = this,
          duration = swift.type(duration) == 'Number' ? duration : (function(preset) {
            if (preset == 'slow') return 700;
            if (preset == 'middle') return 500;
            if (preset == 'fast') return 300;
          })(duration),
          overflow = this.css('overflow');
      if (ts instanceof Object) {
        var styles = {};
        for (var name in ts) {
          var tsv/*target style value*/ = ts[name];
          tsv = swift.asInt(tsv);
          if (isNaN(tsv)) continue;
          var unit = /\D*$/.exec(tsv);
          if (!!unit) unit = 'px';
          var csv/*current style value*/ = this.css(name);
          if (!csv) csv = this.style(name);
          csv = swift.asInt(csv) || 0;
          styles[name] = {start:csv, end:tsv, unit:unit, interpolations:interpolate(csv, tsv, (duration||300)/interval)};
        }
        ele.css('overflow', 'hidden');
        for (var name in styles) {
          (function(name) {
            for (var i in styles[name]['interpolations']) {
              (function(i) {
                setTimeout(function() {
                  ele.css(name, styles[name]['interpolations'][i]+unit);
                }, interval*i);
              })(i);
            }
            setTimeout(function() {
              callback && callback.apply(ele, arguments);
              ele.css('overflow', overflow);
            }, interval*styles[name]['interpolations'].length);
          })(name);
        }
      }
    }
    Swift.prototype.em2px = function() {
      if (!this.length) return;
      if (window.getComputedStyle) {
        return swift.asInt(window.getComputedStyle(this[0], null)['font-size']);
      } else {
        return swift.asInt(this[0].currentStyle["fontSize"]);
      }
    }
    Swift.prototype.first = function() {
      return swift(this.slice(0, 1));
    }
    Swift.prototype.last = function() {
      return swift(this.slice(-1));
    }
    Swift.prototype.firstChild = function() {
      return swift(this.children().slice(0, 1));
    }
    Swift.prototype.lastChild = function() {
      return swift(this.children().slice(-1))
    }
    Swift.prototype.eq = function(i) {
      return swift(this.slice(i, i+1));
    }
    // ### Swift ends
    var type = swift.type(selector);
    if (type == "String") {
      var matched = /^<(\w+)\s*\/?>(?:<\/\1>)?$/.exec(selector);
      if (matched)
        var tags = [window.document.createElement(matched[1])];
      else
        var tags = ctx.querySelectorAll(selector);
    } else if (selector instanceof HTMLElement 
      || selector instanceof HTMLDocument 
      || selector === window)
      var tags = [selector];
    else if (type == 'Array' || type == 'NodeList')
      var tags = selector;
    else if (type == 'Swift')
      return selector;
    else if (type == 'Function') {
    //TODO validate this stuff
      if (/loaded|complete/.test(document.readyState)) {
        selector();
      } else {
        if (window.document.addEventListener) {
          window.document.addEventListener("DOMContentLoaded", selector, false);
        } else if (swift.browser.webkit) {
          var _timer = setInterval(function() {
            if (/loaded|complete/.test(document.readyState)) {
              selector();
              clearInterval(_timer);
            }
          }, 10);
        } else {
          window.onload = selector;
        }
      }
      return;
    }
    return new Swift(tags, selector, ctx);
  }
  swift.log = console.log;
  swift.error = console.error;
  swift.slice = function(items) {
    return Array.prototype.slice.call(items);
  }
  swift.type = function(value) {
    var type = Object.prototype.toString.call(value).slice(8, -1);
    if (type == "Object") {
      var funcNameRegex = /function (.{1,})\(/;
      var results = (funcNameRegex).exec(value.constructor.toString());
      type = (results && results.length > 1) ? results[1] : type;
    }
    return type;
  }
  swift.browser = (function() {
    var ua = navigator.userAgent.toLowerCase(),
        rwebkit = /(webkit)[ \/]([\w.]+)/,
        ropera = /(opera)(?:.*version)?[ \/]([\w.]+)/,
        rmsie = /(msie) ([\w.]+)/,
        rmozilla = /(mozilla)(?:.*? rv:([\w.]+))?/;
    var binfo = rwebkit.exec(ua) || ropera.exec(ua) || rmsie.exec(ua) || rmozilla.exec(ua);
    return {
      name: binfo[1], 
      version: binfo[2],
      webkit: binfo[1] == 'webkit',
      opera: binfo[1] == 'opera',
      msie: binfo[1] == 'msie',
      mozilla: binfo[1] == 'mozilla'
    };
  })();
  swift.filter = function(items, callback) {
    var len = items.length;
    if (typeof callback != "function")
      throw new TypeError();
    var res = [];
    for (var i = 0; i < len; i++) {
      if (i in items) {
        var val = items[i]; // in case fun mutates this
        if (callback.call(val, i, items))
          res.push(val);
      }
    }
    return res;
  }
  swift.htmlEncode = function(source) {
    return source.replace(/</g, '&lt;')
                 .replace(/>/g, '&gt;')
                 .replace(/&/g, '&amp;')
                 .replace(/"/g, '&quot;')
                 .replace(/'/g, '&#39;')
                 .replace(/ /g, '&nbsp;');
  }
  swift.ajax = function(param) {
    if (param == undefined) return;
    if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
      var xmlhttp = new XMLHttpRequest();
    } else {// code for IE6, IE5
      var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    if (param.method.toUpperCase() == 'GET') {
      if (param.data) {
        if (swift.type(param.data) == "String") {
          xmlhttp.send(param.data);
        } else if (swift.type(param.data) == "Object") {
          var data = [];
          for (var i in param.data) {
            data.push("%s=%s".fs(encodeURIComponent(i), encodeURIComponent(param.data[i])));
          }
          param.url += "?" + data.join("&");
        }
      }
    }
    xmlhttp.open(param.method.toUpperCase(), param.url, true);
    for (var key in param.headers) {
      xmlhttp.setRequestHeader(key, param.headers[key]);
    }
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4) {
        if (param[xmlhttp.status]) {
          var ret = {'error': 'HTTP_ERROR', 
                     'status': xmlhttp.status,
                     'headers': xmlhttp.getAllResponseHeaders(), 
                     'body': xmlhttp.responseText};
          param[xmlhttp.status](ret);
        } else if (xmlhttp.status == 200) {
          if (param.success) {
            var type = param.type;
            if (type == undefined || type.toLowerCase() in ['html', 'text']) {
              var ret = xmlhttp.responseText;
            } else if (type.toLowerCase() == 'json') {
              var ret = swift.parseJSON(xmlhttp.responseText);
            } else if (type.toLowerCase() == 'xml') {
              var ret = xmlhttp.responseXML;
            }
            param.success(ret);
          }
        } else if (param.error) {
            var ret = {'error': 'HTTP_ERROR', 
                       'status': xmlhttp.status,
                       'headers': xmlhttp.getAllResponseHeaders(), 
                       'body': xmlhttp.responseText};
            param.error(ret);
        }
      }
    }
    if (param.timeout) {
      setTimeout(function(){
        xmlhttp.abort();
        var ret = {'error': 'TIMEOUT'}
        param.error(ret);
      }, param.timeout);
    }
    if (param.method.toUpperCase() == 'POST') {
      if (!param.data) {
        xmlhttp.send('');
      } else if (swift.type(param.data) == "String") {
        xmlhttp.send(param.data);
      } else if (swift.type(param.data) == "Object") {
        var data = [];
        for (var i in param.data) {
          data.push("%s=%s".fs(encodeURIComponent(i), encodeURIComponent(param.data[i])));
        }
        xmlhttp.send(data.join("&"));
      }
    }
    xmlhttp.send();
  }
  swift.get = function(param) {
    param.method = 'GET';
    return swift.ajax(param);
  }
  swift.post = function(param) {
    param.method = 'POST';
    return swift.ajax(param);
  }
  swift.generateGUID = function() {
    return swift.guid = (swift.guid + 1) || 1;
  }
  swift.isInt = function(n) {
  // Attension: 1E209 is no a int here
    return typeof n == 'number' && parseFloat(n) == parseInt(n) && !isNaN(n);
  }
  swift.styleName = function(name) {
    var camelCase = name.replace(/^-ms-/, "ms-").replace(/-([a-z]|[0-9])/ig, function (all, letter) {
        return (letter + "").toUpperCase();
    });
    if (camelCase == 'float')
      return !!swift('<div></div>').html('<a style="float:left"></a>').find('a')[0].style.cssFloat ? 'cssFloat' : 'styleFloat';
    return camelCase;
  }
  swift.alert = function(msg/*required*/, handler/*optional*/, userStyle/*optional*/) {
    if (!(arguments[1] instanceof Function))
      var style = arguments[1];
    else if (!(arguments[2] instanceof Function))
      var callback = arguments[1],
          style = arguments[2];
    swift('<div></div>').html(msg || '')
                    .css('padding', '20px 50px 20px 50px')
                    .css(style)
                    .dialog({
                      model: true,
                      buttons: {
                        'OK': function(){
                          callback && callback.apply(this, arguments);
                          this.close();
                        }
                      }
                    });
  }
  swift.confirm = function(param) {
    if (!param) return;
    param.yesText = param.yesText || 'OK';
    param.noText = param.noText || 'Cancel';
    swift('<div></div>').html(param.msg || '')
                    .css('padding', '20px 50px 20px 50px')
                    .css(param.style)
                    .dialog({
                      buttons: {
                        'OK': function() {
                          param.yes && param.yes.apply(this, arguments);
                          this.close();
                        },
                        'Cancel': function() {
                          param.no && param.no.apply(this, arguments);
                          this.close();
                        }
                      }
                    });
  }
  swift.human = function(size) {
    if (size < 1024)
        return parseInt(size) + 'B';
    else if (size < 1024 * 1024)
        return parseInt(size/1024*10)/10 + 'KB';
    else if (size < 1024 * 1024 * 1024)
        return parseInt(size/1024/1024*10)/10 + 'MB';
    else if (size < 1024 * 1024 * 1024 * 1024)
        return parseInt(size/1024/1024/1024*10)/10 + 'GB';
    else
        return parseInt(size/1024/1024/1024/1024*10)/10 + 'TB';
  }
  swift.time = function(seconds, secondUnit, minuteUnit, hourUnit, dayUnit) {
    if (seconds < 60)
      return seconds + (secondUnit || 'S');
    else if (seconds < 3600)
      return parseInt(seconds/60)  + (minuteUnit || 'M');
    else if (seconds < 3600*24)
      return parseInt(seconds/3600) + (hourUnit || 'H');
    else
      return parseInt(seconds/3600/24) + (dayUnit || 'D');
  }
  swift.asInt = function(numberWithUnit) {
    return parseInt(/\d*/.exec(numberWithUnit)[0]);
  }
  swift.data = {};
  swift.param = function(data) {
    var mappings = [];
    for (var k in data)
      mappings.push('%s=%s'.fs(k, encodeURIComponent(data[k])));
    return mappings.join('&');
  }
  swift.merge = function() {
    return [].concat(swift.slice(arguments));
  }
  swift.isNumberic = function(data) {
    return !isNaN(parseFloat(data)) && isFinite(data);
  }
  swift.parseXML = function(data) {
    var xml;
    try {
        if (window.DOMParser) 
            xml = new DOMParser().parseFromString(data, "text/xml");
        else {
            xml = new ActiveXObject("Microsoft.XMLDOM");
            xml.async = "false";
            xml.loadXML(data);
        }
    } catch (e) {
        xml = undefined;
    }
    if (!xml || !xml.documentElement || xml.getElementsByTagName("parsererror").length) 
        swift.error("Invalid XML: " + data);
    return xml;
  }
  swift.now = function() {
    return (new Date()).getTime();
  }
  swift.inArray = function(value, arr, startIdx) {
    for (var i=startIdx||0; i<arr.length; i++) {
      if (value === arr[i]) return true;
      else continue;
    }
    return false;
  }
  swift.extend = function() {
    var fns = arguments[0],
        name = arguments[0],
        fn = arguments[1];
    if (arguments.length == 1) {
      for (var name in fns) {
        (function(name) {
          swift[name] = fns[name];
        })(name);
      }
    } else {
      swift[name] = fn;
    }
  }
  swift.cleanData = function() {
    delete this.data;
    this.data = {};
  }
  swift.toJSON = typeof window.JSON === 'object' && window.JSON.stringify ? JSON.stringify : function (o) {
    if (o === null) return 'null';
    var type = typeof o;
    if (type === 'undefined') return undefined;
    if (type === 'number' || type === 'boolean') return '' + o;
    if (type === 'string') return swift.quoteString(o);
    if (type === 'object') {
      if (o.constructor === Date) {
        var month = o.getUTCMonth() + 1,
          day = o.getUTCDate(),
          year = o.getUTCFullYear(),
          hours = o.getUTCHours(),
          minutes = o.getUTCMinutes(),
          seconds = o.getUTCSeconds(),
          milli = o.getUTCMilliseconds();
        if (month < 10) month = '0' + month;
        if (day < 10) day = '0' + day;
        if (hours < 10) hours = '0' + hours;
        if (minutes < 10) minutes = '0' + minutes;
        if (seconds < 10) seconds = '0' + seconds;
        if (milli < 100) milli = '0' + milli;
        if (milli < 10) milli = '0' + milli;
        return '"' + year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds + '.' + milli + 'Z"';
      }
      if (o.constructor === Array) {
        var ret = [];
        for (var i = 0; i < o.length; i++) {
          ret.push(swift.toJSON(o[i]) || 'null');
        }
        return '[' + ret.join(',') + ']';
      }
      var name, val, pairs = [];
      for (var k in o) {
        type = typeof k;
        if (type === 'number')
          name = '"' + k + '"';
        else if (type === 'string')
          name = swift.quoteString(k);
        else 
          continue;
        type = typeof o[k];
        if (type === 'function' || type === 'undefined') 
          continue;
        val = swift.toJSON(o[k]);
        pairs.push(name + ':' + val);
      }
      return '{' + pairs.join(',') + '}';
    }
  }
  swift.parseJSON = swift.evalJSON = typeof window.JSON === 'object' && window.JSON.parse ? window.JSON.parse : function (src) {
    var filtered = src.replace(/\\["\\\/bfnrtu]/g, '@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').replace(/(?:^|:|,)(?:\s*\[)+/g, '');
    if (/^[\],:{}\s]*$/.test(filtered)) 
      return eval('(' + src + ')');
    else 
      swift.error("Invalid JSON: " + o);
  }
  swift.quoteString = function (string) {
    var escapeable = /["\\\x00-\x1f\x7f-\x9f]/g,
        meta = {'\b':'\\b', '\t':'\\t', '\n':'\\n', '\f':'\\f', '\r':'\\r', '"':'\\"', '\\':'\\\\'};
    if (string.match(escapeable)) {
      return '"' + string.replace(escapeable, function (a) {
        var c = meta[a];
        if (typeof c === 'string') 
          return c;
        c = a.charCodeAt();
        return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
      }) + '"';
    }
    return '"' + string + '"';
  }
  swift.isinline = function(tag) {
    return swift.inArray(tag, ["a", "abbr", "acronym", "b", "bdo", "big", "br", "cite", "code", "dfn", "em", "i", "img", "input", "kbd", "label", "q", "samp", "select", "small", "span", "strong", "sub", "sup", "textarea", "tt", "var"]);
  }
})(window);

var $ = window.swift;
$(function(){
	var input_tool = {
		setInputPosition: function(elem, pos) {
			if (elem.setSelectionRange) {
				elem.setSelectionRange(pos, pos);
			} else if (elem.createTextRange) {
				var range = elem.createTextRange();
				range.collapse(true);
				range.moveEnd('character', pos);
				range.moveStart('character', pos);
				range.select();
			}
		},

	    getInputPositon: function (elem) {
	        if (document.selection) {   //IE Support
	            elem.focus();
	            var Sel = document.selection.createRange();
	            return {
	                left: Sel.boundingLeft,
	                top: Sel.boundingTop,
	                bottom: Sel.boundingTop + Sel.boundingHeight
	            };
	        } else {
	            var that = this;
	            var cloneDiv = '{$clone_div}', cloneLeft = '{$cloneLeft}', cloneFocus = '{$cloneFocus}', cloneRight = '{$cloneRight}';
	            var none = '<span style="white-space:pre-wrap;"> </span>';
	            var div = elem[cloneDiv] || document.createElement('div'), focus = elem[cloneFocus] || document.createElement('span');
	            var text = elem[cloneLeft] || document.createElement('span');
	            var offset = that._offset(elem), index = this._getFocus(elem), focusOffset = { left: 0, top: 0 };

	            if (!elem[cloneDiv]) {
	                elem[cloneDiv] = div, elem[cloneFocus] = focus;
	                elem[cloneLeft] = text;
	                div.appendChild(text);
	                div.appendChild(focus);
	                document.body.appendChild(div);
	                focus.innerHTML = '|';
	                focus.style.cssText = 'display:inline-block;width:0px;overflow:hidden;z-index:-100;word-wrap:break-word;word-break:break-all;';
	                div.className = this._cloneStyle(elem);
	                div.style.cssText = 'visibility:hidden;display:inline-block;position:absolute;z-index:-100;word-wrap:break-word;word-break:break-all;overflow:hidden;';
	            };
	            div.style.left = this._offset(elem).left + "px";
	            div.style.top = this._offset(elem).top + "px";
	            var strTmp = elem.value.substring(0, index).replace(/</g, '<').replace(/>/g, '>').replace(/\n/g, '<br/>').replace(/\s/g, none);
	            text.innerHTML = strTmp;

	            focus.style.display = 'inline-block';
	            try { focusOffset = this._offset(focus); } catch (e) { };
	            focus.style.display = 'none';
	            return {
	                left: focusOffset.left,
	                top: focusOffset.top,
	                bottom: focusOffset.bottom
	            };
	        }
	    },

	    // 克隆元素样式并返回类
	    _cloneStyle: function (elem, cache) {
	        if (!cache && elem['${cloneName}']) return elem['${cloneName}'];
	        var className, name, rstyle = /^(number|string)$/;
	        var rname = /^(content|outline|outlineWidth)$/; //Opera: content; IE8:outline && outlineWidth
	        var cssText = [], sStyle = elem.style;

	        for (name in sStyle) {
	            if (!rname.test(name)) {
	                val = this._getStyle(elem, name);
	                if (val !== '' && rstyle.test(typeof val)) { // Firefox 4
	                    name = name.replace(/([A-Z])/g, "-$1").toLowerCase();
	                    cssText.push(name);
	                    cssText.push(':');
	                    cssText.push(val);
	                    cssText.push(';');
	                };
	            };
	        };
	        cssText = cssText.join('');
	        elem['${cloneName}'] = className = 'clone' + (new Date).getTime();
	        this._addHeadStyle('.' + className + '{' + cssText + '}');
	        return className;
	    },

	    // 向页头插入样式
	    _addHeadStyle: function (content) {
	        var style = this._style[document];
	        if (!style) {
	            style = this._style[document] = document.createElement('style');
	            document.getElementsByTagName('head')[0].appendChild(style);
	        };
	        style.styleSheet && (style.styleSheet.cssText += content) || style.appendChild(document.createTextNode(content));
	    },
	    _style: {},

	    // 获取最终样式
	    _getStyle: 'getComputedStyle' in window ? function (elem, name) {
	        return getComputedStyle(elem, null)[name];
	    } : function (elem, name) {
	        return elem.currentStyle[name];
	    },

	    // 获取光标在文本框的位置
	    _getFocus: function (elem) {
	        var index = 0;
	        if (document.selection) {// IE Support
	            elem.focus();
	            var Sel = document.selection.createRange();
	            if (elem.nodeName === 'TEXTAREA') {//textarea
	                var Sel2 = Sel.duplicate();
	                Sel2.moveToElementText(elem);
	                var index = -1;
	                while (Sel2.inRange(Sel)) {
	                    Sel2.moveStart('character');
	                    index++;
	                };
	            }
	            else if (elem.nodeName === 'INPUT') {// input
	                Sel.moveStart('character', -elem.value.length);
	                index = Sel.text.length;
	            }
	        }
	        else if (elem.selectionStart || elem.selectionStart == '0') { // Firefox support
	            index = elem.selectionStart;
	        }
	        return (index);
	    },

	    // 获取元素在页面中位置
	    _offset: function (elem) {
	        var box = elem.getBoundingClientRect(), doc = elem.ownerDocument, body = doc.body, docElem = doc.documentElement;
	        var clientTop = docElem.clientTop || body.clientTop || 0, clientLeft = docElem.clientLeft || body.clientLeft || 0;
	        var top = box.top + (self.pageYOffset || docElem.scrollTop) - clientTop, left = box.left + (self.pageXOffset || docElem.scrollLeft) - clientLeft;
	        return {
	            left: left,
	            top: top,
	            right: left + box.width,
	            bottom: top + box.height
	        };
	    }
	};

	function getPosition(ctrl) {
	    return input_tool.getInputPositon(ctrl);
	}

	var im = {keys: "", page: 0},
		KEY_CODE_SHIFT = 16,
		KEY_CODE_CTRL = 17,
		KEY_CODE_A = 65,
		KEY_CODE_Z = 90,
		KEY_CODE_BACKSPACE = 8,
		KEY_CODE_COMMA = 188,
		KEY_CODE_DOT = 190,
		KEY_CODE_ZERO = 48,
		KEY_CODE_NINE = 57,
		KEY_CODE_SPACE = 32,
		KEY_CODE_LEFT = 37,
		KEY_CODE_UP = 38,
		KEY_CODE_RIGHT = 39,
		KEY_CODE_DOWN = 40,
		KEY_CODE_ENTER = 13,
		KEY_CODE_ESC = 27,
		CANDIDATE = 5,
		IM_DIALOG_ID = "im_dialog",
		IM_INPUT_ID = "im_input",
		IM_SELECTED_CLASS = "im-selected";

	$("<div></div>").appendTo(document.body)
					.attr("id", IM_DIALOG_ID)
					.html("<div id=\"%s\"><input style=\"width:100%;font-size:14px;\" type=\"text\"></div><ul></ul>".fs(IM_INPUT_ID))
					.css({
		"display": "none",
		"padding": 0,
	}).find("ul").css({
		"list-style": "none",
		"padding": "1px 5px",
		"margin": 0
	}).prev().css({
		"padding": "2px 5px",
		"font-size": 16,
		"font-weight": "bold",
		"font-family": "sans-serif"
	});
	var input = $('#%s input'.fs(IM_INPUT_ID)),
		dialog = $('#%s'.fs(IM_DIALOG_ID));
	function keydown(e) {
		//console.log(e.keyCode, im.keys);
		// if (im.ctrled) return;

		if (e.keyCode == KEY_CODE_SHIFT) {
			// shift
			im.shifted = true;
		} else if (e.keyCode >= KEY_CODE_A && e.keyCode <= KEY_CODE_Z || e.keyCode == KEY_CODE_BACKSPACE
					|| e.keyCode == KEY_CODE_COMMA || e.keyCode == KEY_CODE_DOT) {
			// a-z
			if (e.keyCode == KEY_CODE_BACKSPACE) {
				if (im.keys)
					im.keys = im.keys.slice(0, -1);
			} else if (e.keyCode == KEY_CODE_COMMA) {
				im.page = Math.max(im.page - 1, 0);
				im.need_trim = true;
			} else if (e.keyCode == KEY_CODE_DOT) {
				im.page += 1;
				im.need_trim = true;
			} else {
				var key = String.fromCharCode(e.keyCode).toLowerCase();
				im.keys += key;
				im.page = 0;
			}
			// input.val(im.keys);
			if (im.keys) {
				var words = [];
				im.has_next_page = false;
				for (var keys in wordlib) {
					if (keys.startswith(im.keys)) {
						word = wordlib[keys];
						var ws = word.split(",");
						for (var i=0; i<ws.length; i++) {
							words.push(ws[i]);
						}
						if (words.length > CANDIDATE * (im.page+1)) {
							im.has_next_page = true;
							break;
						}
					}
				}
				if (!words.length) {
				}
				if (words.length <= CANDIDATE * im.page)
					if (im.page) im.page -= 1;
				im.has_prev_page = !!im.page;
				words = words.slice(CANDIDATE * im.page, CANDIDATE * (im.page+1));
				if (words.length) {
					var word_list = [];
					for (var i=0; i<words.length; i++) {
						word_list.push("<li class=\"word\">%s. %s</li>".fs(i+1, words[i]));
					}
					if (word_list.length) {
						word_list[0] = '<li class="word %s" style="%s">1. %s</li>'.fs(IM_SELECTED_CLASS, "background:#0099FF;color:#FFF;", words[0]);
					}
					word_list.push("<li class=\"prev\">&lt;</li>");
					word_list.push("<li class=\"next\">&gt;</li>");
					word_list.push("<div style=\"clear:both\"><div>");
					if (im.dialog) {
						im.dialog.find("ul").html(word_list.join(""));
						if (im.has_prev_page) {
							im.dialog.find("ul li.prev").css({
								"color": "#FFF",
								"background": "#0099FF",
								"margin-right": 5
							});
						}
						if (im.has_next_page) {
							im.dialog.find("ul li.next").css({
								"color": "#FFF",
								"background": "#0099FF"
							});
						}
					} else {
						var position = getPosition(src_input);
						var fontSize = $(src_input).style("font-size") || "20";
						if (fontSize.endswith("px")) {
							fontSize = fontSize.slice(0, -2);
						}
						im.dialog = $("#" + IM_DIALOG_ID)
									.find("ul")
									.html(word_list.join(""))
									.parent()
									.dialog({
										style: {
											"border": "0",
											"left": parseInt(position.left),
											"top": parseInt(position.top) + parseInt(fontSize),
											"font-size": 14,
											"color": "#000",
											"box-shadow": "#555 1px 3px 3px",
											"border-radius": "5px",
											"height": 55,
											"padding": "0 6px",
											"background": "#E5E5E5"
										}
									});
						im.started = true;
					}
					im.dialog.find("li").css({
						"font-size": 14,
						"float": "left",
						"padding": "1px 5px 1px 5px",
						"margin-right": 5,
						"cursor": "pointer"
					}).filter(".word").click(function(e) {
						var selected_word_tag_li = im.dialog.find("ul>li.%s".fs(IM_SELECTED_CLASS)),
							target_word_tag_li = $(this);
						if (target_word_tag_li) {
							if (selected_word_tag_li) {
								selected_word_tag_li.removeClass(IM_SELECTED_CLASS).css("background", "").css("color", "");
							}
							target_word_tag_li.addClass(IM_SELECTED_CLASS).css("background", "#0099FF").css("color", "#FFF");
							im.word = target_word_tag_li.html().substr(3);
						} else {
							delete im.word;
						}
						input.val("");
						if (im.word) {
							src_input.value = src_input.value.slice(0, im.cursor) + im.word + src_input.value.slice(im.cursor);
              im.cursor += im.word.length;
						}
						im.keys = "";
						im.dialog && im.dialog.close();
						src_input.focus();
						input_tool.setInputPosition(src_input, im.cursor);
						im.word = "";
						delete im.dialog;
					});
					im.dialog.find('li.prev').click(function(e) {
						// im.page = Math.max(im.page - 1, 0);
						keydown.call(this, {keyCode: KEY_CODE_COMMA});
						im.need_trim = false;
					});
					im.dialog.find('li.next').click(function(e) {
						// im.page += 1;
						keydown.call(this, {keyCode: KEY_CODE_DOT});
						im.need_trim = false;
					});
				} else {
					im.dialog.find("ul li.word").remove();
					// im.word = "";
					// im.ended = true;
				}
			} else if (im.dialog) {
				im.started = false;
				im.ended = true;
			}
		} else if (e.keyCode > KEY_CODE_ZERO && e.keyCode <= KEY_CODE_ZERO + CANDIDATE) {
			// 1-5
			if (im.dialog) {
				var key = String.fromCharCode(e.keyCode),
					selected_word_tag_li = im.dialog.find("ul>li.%s".fs(IM_SELECTED_CLASS)),
					target_word_tag_li = $(im.dialog.find("ul>li")[key-1]);
				if (target_word_tag_li) {
					if (selected_word_tag_li) {
						selected_word_tag_li.removeClass(IM_SELECTED_CLASS).css("background", "").css("color", "");
					}
					target_word_tag_li.addClass(IM_SELECTED_CLASS).css("background", "#0099FF").css("color", "#FFF");
					im.word = target_word_tag_li.html().substr(3);
				} else {
					delete im.word;
				}
				im.ended = true;
				// im.keys += key;
			}
		} else if (e.keyCode == KEY_CODE_CTRL) {
			// ctrl
			im.ctrled = true;
		} else if (e.keyCode == KEY_CODE_LEFT || e.keyCode == KEY_CODE_RIGHT) {
		} else if (e.keyCode == KEY_CODE_UP || e.keyCode == KEY_CODE_DOWN) {
			if (im.dialog) {
				var selected_word_tag_li = im.dialog.find("ul>li.%s".fs(IM_SELECTED_CLASS));
				if (selected_word_tag_li) {
					var target_word_tag_li = e.keyCode == KEY_CODE_UP ? selected_word_tag_li.prev() : selected_word_tag_li.next();
					if (target_word_tag_li) {
						selected_word_tag_li.removeClass(IM_SELECTED_CLASS).css("background", "").css("color", "");
						target_word_tag_li.addClass(IM_SELECTED_CLASS).css("background", "#0099FF").css("color", "#FFF");
					}
				}
			}
		} else if (e.keyCode == KEY_CODE_SPACE) {
			// enter
			if (im.dialog) {
				var selected_word_tag_li = im.dialog.find("ul>li.%s".fs(IM_SELECTED_CLASS));
				if (selected_word_tag_li.length) {
					im.word = selected_word_tag_li.html().substr(3);
					im.need_trim = (e.keyCode == KEY_CODE_SPACE);
					im.ended = true;
				} else {
					im.keys += " ";
				}
			}
		} else if (e.keyCode == KEY_CODE_ENTER) {
			// enter
			if (im.dialog) {
				im.word = im.keys;
				im.ended = true;
			}
		} else if (e.keyCode == KEY_CODE_ESC) {
			im.ended = true;
			im.keys = "";
		}
	}
	function keyup(e) {
		var key = String.fromCharCode(e.keyCode).toLowerCase();
		if (key == "shift") {
			im.shifted = false;
		}
		if (im.ended) {
			input.val("");
			if (im.word) {
        src_input.value = src_input.value.slice(0, im.cursor) + im.word + src_input.value.slice(im.cursor);
        im.cursor += im.word.length;
			}
			im.keys = "";
			im.ended = false;
			im.dialog && im.dialog.close();
			src_input.focus();
			input_tool.setInputPosition(src_input, im.cursor);
			im.word = "";
			delete im.dialog;
		}
		im.ctrled = false;
		if (im.need_trim) {
			input.val(input.val().slice(0, -1));
			im.need_trim = false;
		}
	}
	var src_input = null;
	$("input,textarea").filter("!#%s input".fs(IM_INPUT_ID)).live("keydown", function(e){
		src_input = this;
    im.cursor = input_tool._getFocus(src_input);
		keydown.call(input, e);
		input.focus();
	}).live("keyup", function(e) {
		e.stopPropagation();
	});
	input.keydown(keydown).keyup(keyup);
});

